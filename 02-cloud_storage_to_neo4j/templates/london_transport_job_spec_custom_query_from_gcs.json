{
  "version": "1",
  "config": {
    "reset_db": true
  },
  "sources": [
    {
      "type": "text",
      "name": "stations",
      "format": "excel",
      "header": [
        "ID",
        "Station_Name",
        "OS_X",
        "OS_Y",
        "Latitude",
        "Longitude",
        "Zone",
        "Postcode",
        "Zone_original"
      ],
      "urls": [
        "gs://neo4j-datasets/dataflow-london-transport/gcs-to-neo4j/source-data/London_stations_no_headers.csv"
      ]
    },
    {
      "type": "text",
      "name": "tube_lines",
      "format": "excel",
      "header": [
        "Tube_Line",
        "From_Station",
        "To_Station"
      ],
      "urls": [
        "gs://neo4j-datasets/dataflow-london-transport/gcs-to-neo4j/source-data/London_tube_lines_no_headers.csv"
      ]
    }
  ],
  "targets": {
    "nodes": [
      {
        "source": "stations",
        "name": "Station",
        "write_mode": "merge",
        "source_transformations": {
          "enable_grouping": true
        },
        "labels": [
          "Station"
        ],
        "properties": [
          {
            "source_field": "ID",
            "target_property": "station_id"
          },
          {
            "source_field": "Station_Name",
            "target_property": "name",
            "target_property_type": "string"
          },
          {
            "source_field": "Zone",
            "target_property": "zone",
            "target_property_type": "string"
          },
          {
            "source_field": "Postcode",
            "target_property": "postcode",
            "target_property_type": "string"
          },
          {
            "source_field": "Longitude",
            "target_property": "longitude",
            "target_property_type": "float"
          },
          {
            "source_field": "Latitude",
            "target_property": "latitude",
            "target_property_type": "string"
          }
        ],
        "schema": {
          "key_constraints": [
            {
              "name": "station_id",
              "label": "Station",
              "properties": [
                "station_id"
              ]
            }
          ],
          "range_indexes": [
            {
              "name": "ix_station_name",
              "label": "Station",
              "properties": [
                "name"
              ]
            }
          ]
        }
      }
    ],
    "queries": [
      {
        "source": "tube_lines",
        "name": "Tube Lines",
        "query": "UNWIND $rows as row MATCH (a:Station) WHERE a.name = row.From_Station MATCH (b:Station) WHERE b.name = row.To_Station CREATE (a)-[r:CONNECTED_TO]->(b) SET r.line = row.Tube_Line",
        "depends_on": [
          "Station"
        ]
      }
    ]
  }
}